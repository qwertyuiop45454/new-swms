<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>到货验收单</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1E40AF',
                        secondary: '#3B82F6',
                        success: '#10B981',
                        warning: '#F59E0B',
                        danger: '#EF4444',
                        neutral: {
                            100: '#F3F4F6',
                            200: '#E5E7EB',
                            300: '#D1D5DB',
                            400: '#9CA3AF',
                            500: '#6B7280',
                            600: '#4B5563',
                            700: '#374151',
                            800: '#1F2937',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .form-input-focus {
                @apply focus:border-primary focus:ring-1 focus:ring-primary focus:outline-none transition-all;
            }
            .btn-hover {
                @apply transition-all duration-200 hover:shadow-md active:scale-95;
            }
            .card-shadow {
                @apply shadow-sm border border-neutral-200 rounded-lg bg-white;
            }
            .input-error {
                @apply border-danger focus:border-danger focus:ring-danger;
            }
        }
    </style>
</head>
<body class="bg-neutral-100 p-4 md:p-6">
    <div class="max-w-6xl mx-auto">
        <!-- 页面标题 -->
        <div class="mb-6 text-center md:text-left">
            <h1 class="text-[clamp(1.5rem,3vw,2rem)] font-bold text-neutral-800">到货验收单</h1>
            <p class="text-neutral-500 mt-1">对到货物料进行质量和数量验收确认</p>
        </div>

        <!-- 验收单主体 -->
        <form id="inspectionForm" class="space-y-6">
            <!-- 验收单基本信息 -->
            <div class="card-shadow p-5">
                <h2 class="text-lg font-semibold text-neutral-800 mb-4 pb-2 border-b border-neutral-200">
                    <i class="fa fa-file-text-o text-primary mr-2"></i>验收单信息
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label for="inspectionNo" class="block text-sm font-medium text-neutral-700 mb-1">验收单号 <span class="text-danger">*</span></label>
                        <input type="text" id="inspectionNo" readonly
                               class="w-full px-3 py-2 border border-neutral-300 rounded-md bg-neutral-50"
                               placeholder="系统自动生成">
                        <p id="inspectionNoError" class="mt-1 text-sm text-danger hidden"></p>
                    </div>
                    
                    <div>
                        <label for="inspectionDate" class="block text-sm font-medium text-neutral-700 mb-1">验收日期 <span class="text-danger">*</span></label>
                        <input type="date" id="inspectionDate" 
                               class="w-full px-3 py-2 border border-neutral-300 rounded-md form-input-focus">
                        <p id="inspectionDateError" class="mt-1 text-sm text-danger hidden"></p>
                    </div>
                    
                    <div>
                        <label for="inspector" class="block text-sm font-medium text-neutral-700 mb-1">验收人 <span class="text-danger">*</span></label>
                        <input type="text" id="inspector" 
                               class="w-full px-3 py-2 border border-neutral-300 rounded-md form-input-focus"
                               placeholder="请输入验收人姓名">
                        <p id="inspectorError" class="mt-1 text-sm text-danger hidden"></p>
                    </div>
                </div>
            </div>

            <!-- 供应商信息 -->
            <div class="card-shadow p-5">
                <h2 class="text-lg font-semibold text-neutral-800 mb-4 pb-2 border-b border-neutral-200">
                    <i class="fa fa-building text-primary mr-2"></i>供应商信息
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="supplierName" class="block text-sm font-medium text-neutral-700 mb-1">供应商名称 <span class="text-danger">*</span></label>
                        <input type="text" id="supplierName" 
                               class="w-full px-3 py-2 border border-neutral-300 rounded-md form-input-focus"
                               placeholder="请输入供应商名称">
                        <p id="supplierNameError" class="mt-1 text-sm text-danger hidden"></p>
                    </div>
                    
                    <div>
                        <label for="supplierCode" class="block text-sm font-medium text-neutral-700 mb-1">供应商编码 <span class="text-danger">*</span></label>
                        <input type="text" id="supplierCode" 
                               class="w-full px-3 py-2 border border-neutral-300 rounded-md form-input-focus"
                               placeholder="请输入供应商编码">
                        <p id="supplierCodeError" class="mt-1 text-sm text-danger hidden"></p>
                    </div>
                    
                    <div>
                        <label for="contactPerson" class="block text-sm font-medium text-neutral-700 mb-1">联系人</label>
                        <input type="text" id="contactPerson" 
                               class="w-full px-3 py-2 border border-neutral-300 rounded-md form-input-focus"
                               placeholder="请输入联系人姓名">
                    </div>
                    
                    <div>
                        <label for="contactPhone" class="block text-sm font-medium text-neutral-700 mb-1">联系电话 <span class="text-danger">*</span></label>
                        <input type="tel" id="contactPhone" 
                               class="w-full px-3 py-2 border border-neutral-300 rounded-md form-input-focus"
                               placeholder="请输入联系电话">
                        <p id="contactPhoneError" class="mt-1 text-sm text-danger hidden"></p>
                    </div>
                </div>
            </div>

            <!-- 到货基本信息 -->
            <div class="card-shadow p-5">
                <h2 class="text-lg font-semibold text-neutral-800 mb-4 pb-2 border-b border-neutral-200">
                    <i class="fa fa-truck text-primary mr-2"></i>到货基本信息
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label for="purchaseNo" class="block text-sm font-medium text-neutral-700 mb-1">采购单号 <span class="text-danger">*</span></label>
                        <input type="text" id="purchaseNo" 
                               class="w-full px-3 py-2 border border-neutral-300 rounded-md form-input-focus"
                               placeholder="请输入采购单号">
                        <p id="purchaseNoError" class="mt-1 text-sm text-danger hidden"></p>
                    </div>
                    
                    <div>
                        <label for="deliveryNo" class="block text-sm font-medium text-neutral-700 mb-1">送货单号 <span class="text-danger">*</span></label>
                        <input type="text" id="deliveryNo" 
                               class="w-full px-3 py-2 border border-neutral-300 rounded-md form-input-focus"
                               placeholder="请输入送货单号">
                        <p id="deliveryNoError" class="mt-1 text-sm text-danger hidden"></p>
                    </div>
                    
                    <div>
                        <label for="deliveryDate" class="block text-sm font-medium text-neutral-700 mb-1">到货日期 <span class="text-danger">*</span></label>
                        <input type="date" id="deliveryDate" 
                               class="w-full px-3 py-2 border border-neutral-300 rounded-md form-input-focus">
                        <p id="deliveryDateError" class="mt-1 text-sm text-danger hidden"></p>
                    </div>
                    
                    <div>
                        <label for="warehouse" class="block text-sm font-medium text-neutral-700 mb-1">收货仓库 <span class="text-danger">*</span></label>
                        <select id="warehouse" class="w-full px-3 py-2 border border-neutral-300 rounded-md form-input-focus">
                            <option value="">请选择仓库</option>
                            <option value="1">一号仓库</option>
                            <option value="2">二号仓库</option>
                            <option value="3">三号仓库</option>
                            <option value="4">四号仓库</option>
                        </select>
                        <p id="warehouseError" class="mt-1 text-sm text-danger hidden"></p>
                    </div>
                    
                    <div>
                        <label for="deliveryPerson" class="block text-sm font-medium text-neutral-700 mb-1">送货人</label>
                        <input type="text" id="deliveryPerson" 
                               class="w-full px-3 py-2 border border-neutral-300 rounded-md form-input-focus"
                               placeholder="请输入送货人姓名">
                    </div>
                    
                    <div>
                        <label for="vehicleNo" class="block text-sm font-medium text-neutral-700 mb-1">车牌号</label>
                        <input type="text" id="vehicleNo" 
                               class="w-full px-3 py-2 border border-neutral-300 rounded-md form-input-focus"
                               placeholder="请输入车牌号">
                    </div>
                </div>
            </div>

            <!-- 物料明细验收 -->
            <div class="card-shadow p-5">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4">
                    <h2 class="text-lg font-semibold text-neutral-800 pb-2 border-b border-neutral-200 w-full sm:w-auto">
                        <i class="fa fa-list-alt text-primary mr-2"></i>物料明细验收
                    </h2>
                    <button type="button" id="addMaterialBtn" class="mt-2 sm:mt-0 text-primary text-sm flex items-center btn-hover">
                        <i class="fa fa-plus-circle mr-1"></i> 添加物料
                    </button>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full text-sm" id="materialsTable">
                        <thead>
                            <tr class="bg-neutral-50">
                                <th class="px-3 py-3 text-left text-neutral-700 font-medium">序号</th>
                                <th class="px-3 py-3 text-left text-neutral-700 font-medium">物料编码 <span class="text-danger">*</span></th>
                                <th class="px-3 py-3 text-left text-neutral-700 font-medium">物料名称 <span class="text-danger">*</span></th>
                                <th class="px-3 py-3 text-left text-neutral-700 font-medium">规格型号</th>
                                <th class="px-3 py-3 text-left text-neutral-700 font-medium">单位 <span class="text-danger">*</span></th>
                                <th class="px-3 py-3 text-left text-neutral-700 font-medium">订单数量 <span class="text-danger">*</span></th>
                                <th class="px-3 py-3 text-left text-neutral-700 font-medium">到货数量 <span class="text-danger">*</span></th>
                                <th class="px-3 py-3 text-left text-neutral-700 font-medium">验收数量 <span class="text-danger">*</span></th>
                                <th class="px-3 py-3 text-left text-neutral-700 font-medium">验收结果 <span class="text-danger">*</span></th>
                                <th class="px-3 py-3 text-left text-neutral-700 font-medium">不合格原因</th>
                                <th class="px-3 py-3 text-left text-neutral-700 font-medium">操作</th>
                            </tr>
                        </thead>
                        <tbody id="materialsBody">
                            <tr class="border-t border-neutral-200 material-row">
                                <td class="px-3 py-3 material-index">1</td>
                                <td class="px-3 py-3">
                                    <input type="text" class="material-code w-full px-3 py-2 border border-neutral-300 rounded-md form-input-focus"
                                           placeholder="物料编码">
                                    <p class="mt-1 text-sm text-danger material-code-error hidden"></p>
                                </td>
                                <td class="px-3 py-3">
                                    <input type="text" class="material-name w-full px-3 py-2 border border-neutral-300 rounded-md form-input-focus"
                                           placeholder="物料名称">
                                    <p class="mt-1 text-sm text-danger material-name-error hidden"></p>
                                </td>
                                <td class="px-3 py-3">
                                    <input type="text" class="material-spec w-full px-3 py-2 border border-neutral-300 rounded-md form-input-focus"
                                           placeholder="规格型号">
                                </td>
                                <td class="px-3 py-3">
                                    <input type="text" class="material-unit w-full px-3 py-2 border border-neutral-300 rounded-md form-input-focus"
                                           placeholder="单位">
                                    <p class="mt-1 text-sm text-danger material-unit-error hidden"></p>
                                </td>
                                <td class="px-3 py-3">
                                    <input type="number" min="1" class="material-order-qty w-full px-3 py-2 border border-neutral-300 rounded-md form-input-focus"
                                           placeholder="订单数量">
                                    <p class="mt-1 text-sm text-danger material-order-qty-error hidden"></p>
                                </td>
                                <td class="px-3 py-3">
                                    <input type="number" min="0" class="material-delivery-qty w-full px-3 py-2 border border-neutral-300 rounded-md form-input-focus"
                                           placeholder="到货数量">
                                    <p class="mt-1 text-sm text-danger material-delivery-qty-error hidden"></p>
                                </td>
                                <td class="px-3 py-3">
                                    <input type="number" min="0" class="material-accept-qty w-full px-3 py-2 border border-neutral-300 rounded-md form-input-focus"
                                           placeholder="验收数量">
                                    <p class="mt-1 text-sm text-danger material-accept-qty-error hidden"></p>
                                </td>
                                <td class="px-3 py-3">
                                    <select class="material-result w-full px-3 py-2 border border-neutral-300 rounded-md form-input-focus">
                                        <option value="">请选择</option>
                                        <option value="qualified">合格</option>
                                        <option value="unqualified">不合格</option>
                                        <option value="partial">部分合格</option>
                                    </select>
                                    <p class="mt-1 text-sm text-danger material-result-error hidden"></p>
                                </td>
                                <td class="px-3 py-3">
                                    <textarea class="material-reason w-full px-3 py-2 border border-neutral-300 rounded-md form-input-focus"
                                              rows="2" placeholder="请填写不合格原因（如适用）"></textarea>
                                </td>
                                <td class="px-3 py-3">
                                    <button type="button" class="text-danger hover:text-danger/80 remove-material" disabled>
                                        <i class="fa fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <p id="materialsError" class="mt-2 text-sm text-danger hidden">请至少添加一种物料</p>
            </div>

            <!-- 验收结论 -->
            <div class="card-shadow p-5">
                <h2 class="text-lg font-semibold text-neutral-800 mb-4 pb-2 border-b border-neutral-200">
                    <i class="fa fa-check-square-o text-primary mr-2"></i>验收结论
                </h2>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-neutral-700 mb-1">总体验收结果 <span class="text-danger">*</span></label>
                        <div class="flex flex-wrap gap-4">
                            <label class="inline-flex items-center">
                                <input type="radio" name="overallResult" value="allQualified" class="form-radio text-primary focus:ring-primary h-4 w-4">
                                <span class="ml-2 text-neutral-700">全部合格</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="overallResult" value="partialQualified" class="form-radio text-primary focus:ring-primary h-4 w-4">
                                <span class="ml-2 text-neutral-700">部分合格</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="overallResult" value="allUnqualified" class="form-radio text-primary focus:ring-primary h-4 w-4">
                                <span class="ml-2 text-neutral-700">全部不合格</span>
                            </label>
                        </div>
                        <p id="overallResultError" class="mt-1 text-sm text-danger hidden"></p>
                    </div>
                    
                    <div>
                        <label for="inspectionComment" class="block text-sm font-medium text-neutral-700 mb-1">验收备注</label>
                        <textarea id="inspectionComment" rows="4" 
                                  class="w-full px-3 py-2 border border-neutral-300 rounded-md form-input-focus"
                                  placeholder="请输入验收备注信息"></textarea>
                    </div>
                </div>
            </div>

            <!-- 操作按钮 -->
            <div class="flex flex-col sm:flex-row justify-end gap-3 pt-4 border-t border-neutral-200">
                <button type="button" id="resetBtn" class="px-5 py-2.5 border border-neutral-300 rounded-md text-neutral-700 hover:bg-neutral-50 btn-hover">
                    重置
                </button>
                <button type="button" id="saveDraftBtn" class="px-5 py-2.5 border border-secondary bg-secondary/10 text-secondary rounded-md btn-hover">
                    保存草稿
                </button>
                <button type="submit" class="px-5 py-2.5 bg-primary text-white rounded-md btn-hover">
                    提交验收结果
                </button>
            </div>
        </form>
    </div>

    <!-- 提示消息 -->
    <div id="toast" class="fixed top-4 right-4 px-4 py-3 rounded-md shadow-lg transform transition-all duration-300 translate-x-full opacity-0 z-50 flex items-center gap-2"></div>

    <script>
        // DOM元素
        const inspectionForm = document.getElementById('inspectionForm');
        const materialsBody = document.getElementById('materialsBody');
        const addMaterialBtn = document.getElementById('addMaterialBtn');
        const resetBtn = document.getElementById('resetBtn');
        const saveDraftBtn = document.getElementById('saveDraftBtn');
        const toast = document.getElementById('toast');
        
        // 初始化页面
        function init() {
            // 生成验收单号
            generateInspectionNo();
            
            // 设置默认日期为今天
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('inspectionDate').value = today;
            document.getElementById('deliveryDate').value = today;
            
            // 添加物料行
            addMaterialBtn.addEventListener('click', addMaterialRow);
            
            // 重置表单
            resetBtn.addEventListener('click', function() {
                if (confirm('确定要重置表单吗？所有已填写的内容将被清空。')) {
                    inspectionForm.reset();
                    // 保留默认值
                    document.getElementById('inspectionNo').value = generateInspectionNo();
                    document.getElementById('inspectionDate').value = today;
                    document.getElementById('deliveryDate').value = today;
                    
                    // 重置物料表格，只保留一行
                    while (materialsBody.children.length > 1) {
                        materialsBody.removeChild(materialsBody.lastChild);
                    }
                    
                    // 重置第一行
                    const firstRow = materialsBody.querySelector('.material-row');
                    firstRow.querySelectorAll('input, select, textarea').forEach(el => {
                        el.value = '';
                    });
                    
                    clearErrors();
                    updateRemoveButtons();
                    updateMaterialIndices();
                }
            });
            
            // 保存草稿
            saveDraftBtn.addEventListener('click', function() {
                if (validateBasicInfo()) {
                    showToast('草稿已保存', 'info');
                }
            });
            
            // 表单提交
            inspectionForm.addEventListener('submit', function(e) {
                e.preventDefault();
                if (validateForm()) {
                    // 模拟提交
                    showToast('验收结果已提交成功', 'success');
                    setTimeout(() => {
                        // 实际应用中这里会提交到服务器
                        console.log('表单提交成功');
                    }, 800);
                }
            });
            
            // 初始化事件绑定
            updateRemoveButtons();
            bindRemoveMaterialEvents();
        }
        
        // 生成验收单号
        function generateInspectionNo() {
            const date = new Date();
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const random = Math.floor(100 + Math.random() * 900); // 3位随机数
            const no = `INSP-${year}${month}${day}-${random}`;
            document.getElementById('inspectionNo').value = no;
            return no;
        }
        
        // 添加物料行
        function addMaterialRow() {
            const rows = document.querySelectorAll('.material-row');
            const newIndex = rows.length + 1;
            
            const newRow = document.createElement('tr');
            newRow.className = 'border-t border-neutral-200 material-row';
            newRow.innerHTML = `
                <td class="px-3 py-3 material-index">${newIndex}</td>
                <td class="px-3 py-3">
                    <input type="text" class="material-code w-full px-3 py-2 border border-neutral-300 rounded-md form-input-focus"
                           placeholder="物料编码">
                    <p class="mt-1 text-sm text-danger material-code-error hidden"></p>
                </td>
                <td class="px-3 py-3">
                    <input type="text" class="material-name w-full px-3 py-2 border border-neutral-300 rounded-md form-input-focus"
                           placeholder="物料名称">
                    <p class="mt-1 text-sm text-danger material-name-error hidden"></p>
                </td>
                <td class="px-3 py-3">
                    <input type="text" class="material-spec w-full px-3 py-2 border border-neutral-300 rounded-md form-input-focus"
                           placeholder="规格型号">
                </td>
                <td class="px-3 py-3">
                    <input type="text" class="material-unit w-full px-3 py-2 border border-neutral-300 rounded-md form-input-focus"
                           placeholder="单位">
                    <p class="mt-1 text-sm text-danger material-unit-error hidden"></p>
                </td>
                <td class="px-3 py-3">
                    <input type="number" min="1" class="material-order-qty w-full px-3 py-2 border border-neutral-300 rounded-md form-input-focus"
                           placeholder="订单数量">
                    <p class="mt-1 text-sm text-danger material-order-qty-error hidden"></p>
                </td>
                <td class="px-3 py-3">
                    <input type="number" min="0" class="material-delivery-qty w-full px-3 py-2 border border-neutral-300 rounded-md form-input-focus"
                           placeholder="到货数量">
                    <p class="mt-1 text-sm text-danger material-delivery-qty-error hidden"></p>
                </td>
                <td class="px-3 py-3">
                    <input type="number" min="0" class="material-accept-qty w-full px-3 py-2 border border-neutral-300 rounded-md form-input-focus"
                           placeholder="验收数量">
                    <p class="mt-1 text-sm text-danger material-accept-qty-error hidden"></p>
                </td>
                <td class="px-3 py-3">
                    <select class="material-result w-full px-3 py-2 border border-neutral-300 rounded-md form-input-focus">
                        <option value="">请选择</option>
                        <option value="qualified">合格</option>
                        <option value="unqualified">不合格</option>
                        <option value="partial">部分合格</option>
                    </select>
                    <p class="mt-1 text-sm text-danger material-result-error hidden"></p>
                </td>
                <td class="px-3 py-3">
                    <textarea class="material-reason w-full px-3 py-2 border border-neutral-300 rounded-md form-input-focus"
                              rows="2" placeholder="请填写不合格原因（如适用）"></textarea>
                </td>
                <td class="px-3 py-3">
                    <button type="button" class="text-danger hover:text-danger/80 remove-material">
                        <i class="fa fa-trash"></i>
                    </button>
                </td>
            `;
            
            materialsBody.appendChild(newRow);
            updateRemoveButtons();
            bindRemoveMaterialEvents();
            
            // 为新行添加到货数量变化事件
            const deliveryQtyInput = newRow.querySelector('.material-delivery-qty');
            const acceptQtyInput = newRow.querySelector('.material-accept-qty');
            
            deliveryQtyInput.addEventListener('change', function() {
                // 到货数量变化时，自动填充验收数量
                if (this.value && !acceptQtyInput.value) {
                    acceptQtyInput.value = this.value;
                }
            });
        }
        
        // 绑定删除物料事件
        function bindRemoveMaterialEvents() {
            document.querySelectorAll('.remove-material').forEach(btn => {
                btn.addEventListener('click', function() {
                    if (document.querySelectorAll('.material-row').length > 1) {
                        this.closest('.material-row').remove();
                        updateRemoveButtons();
                        updateMaterialIndices();
                    }
                });
            });
            
            // 为所有到货数量输入框添加事件
            document.querySelectorAll('.material-delivery-qty').forEach(input => {
                input.addEventListener('change', function() {
                    const row = this.closest('.material-row');
                    const acceptQtyInput = row.querySelector('.material-accept-qty');
                    
                    // 到货数量变化时，自动填充验收数量（如果验收数量为空）
                    if (this.value && !acceptQtyInput.value) {
                        acceptQtyInput.value = this.value;
                    }
                });
            });
            
            // 为所有验收结果下拉框添加事件
            document.querySelectorAll('.material-result').forEach(select => {
                select.addEventListener('change', function() {
                    const row = this.closest('.material-row');
                    const reasonTextarea = row.querySelector('.material-reason');
                    
                    // 如果选择不合格或部分合格，显示原因输入框
                    if (this.value === 'unqualified' || this.value === 'partial') {
                        reasonTextarea.classList.add('border-primary');
                    } else {
                        reasonTextarea.classList.remove('border-primary');
                    }
                });
            });
        }
        
        // 更新删除按钮状态
        function updateRemoveButtons() {
            const rows = document.querySelectorAll('.material-row');
            const removeButtons = document.querySelectorAll('.remove-material');
            
            if (rows.length <= 1) {
                removeButtons.forEach(btn => {
                    btn.disabled = true;
                    btn.classList.add('opacity-50', 'cursor-not-allowed');
                });
            } else {
                removeButtons.forEach(btn => {
                    btn.disabled = false;
                    btn.classList.remove('opacity-50', 'cursor-not-allowed');
                });
            }
        }
        
        // 更新物料序号
        function updateMaterialIndices() {
            const rows = document.querySelectorAll('.material-row');
            rows.forEach((row, index) => {
                row.querySelector('.material-index').textContent = index + 1;
            });
        }
        
        // 清除错误提示
        function clearErrors() {
            // 清除表单错误
            document.querySelectorAll('[id$="Error"]').forEach(el => {
                el.classList.add('hidden');
                el.textContent = '';
            });
            
            // 清除输入框错误状态
            document.querySelectorAll('input, select, textarea').forEach(el => {
                el.classList.remove('input-error');
            });
            
            // 清除物料行错误
            document.querySelectorAll('.material-code-error, .material-name-error, .material-unit-error, .material-order-qty-error, .material-delivery-qty-error, .material-accept-qty-error, .material-result-error').forEach(el => {
                el.classList.add('hidden');
                el.textContent = '';
            });
        }
        
        // 显示错误信息
        function showError(inputEl, errorId, message) {
            inputEl.classList.add('input-error');
            const errorEl = document.getElementById(errorId);
            errorEl.textContent = message;
            errorEl.classList.remove('hidden');
        }
        
        // 显示物料行错误
        function showMaterialRowError(inputEl, errorEl, message) {
            inputEl.classList.add('input-error');
            errorEl.textContent = message;
            errorEl.classList.remove('hidden');
        }
        
        // 验证基本信息（保存草稿用）
        function validateBasicInfo() {
            let isValid = true;
            clearErrors();
            
            // 验收日期验证
            const inspectionDate = document.getElementById('inspectionDate');
            if (!inspectionDate.value) {
                showError(inspectionDate, 'inspectionDateError', '请选择验收日期');
                isValid = false;
            }
            
            // 验收人验证
            const inspector = document.getElementById('inspector');
            if (!inspector.value.trim()) {
                showError(inspector, 'inspectorError', '请输入验收人姓名');
                isValid = false;
            }
            
            // 供应商名称验证
            const supplierName = document.getElementById('supplierName');
            if (!supplierName.value.trim()) {
                showError(supplierName, 'supplierNameError', '请输入供应商名称');
                isValid = false;
            }
            
            // 采购单号验证
            const purchaseNo = document.getElementById('purchaseNo');
            if (!purchaseNo.value.trim()) {
                showError(purchaseNo, 'purchaseNoError', '请输入采购单号');
                isValid = false;
            }
            
            // 送货单号验证
            const deliveryNo = document.getElementById('deliveryNo');
            if (!deliveryNo.value.trim()) {
                showError(deliveryNo, 'deliveryNoError', '请输入送货单号');
                isValid = false;
            }
            
            return isValid;
        }
        
        // 验证完整表单
        function validateForm() {
            let isValid = true;
            clearErrors();
            
            // 验收日期验证
            const inspectionDate = document.getElementById('inspectionDate');
            if (!inspectionDate.value) {
                showError(inspectionDate, 'inspectionDateError', '请选择验收日期');
                isValid = false;
            }
            
            // 验收人验证
            const inspector = document.getElementById('inspector');
            if (!inspector.value.trim()) {
                showError(inspector, 'inspectorError', '请输入验收人姓名');
                isValid = false;
            }
            
            // 供应商名称验证
            const supplierName = document.getElementById('supplierName');
            if (!supplierName.value.trim()) {
                showError(supplierName, 'supplierNameError', '请输入供应商名称');
                isValid = false;
            }
            
            // 供应商编码验证
            const supplierCode = document.getElementById('supplierCode');
            if (!supplierCode.value.trim()) {
                showError(supplierCode, 'supplierCodeError', '请输入供应商编码');
                isValid = false;
            }
            
            // 联系电话验证
            const contactPhone = document.getElementById('contactPhone');
            if (!contactPhone.value.trim()) {
                showError(contactPhone, 'contactPhoneError', '请输入联系电话');
                isValid = false;
            } else if (!/^1[3-9]\d{9}$/.test(contactPhone.value.trim())) {
                showError(contactPhone, 'contactPhoneError', '请输入有效的手机号码');
                isValid = false;
            }
            
            // 采购单号验证
            const purchaseNo = document.getElementById('purchaseNo');
            if (!purchaseNo.value.trim()) {
                showError(purchaseNo, 'purchaseNoError', '请输入采购单号');
                isValid = false;
            }
            
            // 送货单号验证
            const deliveryNo = document.getElementById('deliveryNo');
            if (!deliveryNo.value.trim()) {
                showError(deliveryNo, 'deliveryNoError', '请输入送货单号');
                isValid = false;
            }
            
            // 到货日期验证
            const deliveryDate = document.getElementById('deliveryDate');
            if (!deliveryDate.value) {
                showError(deliveryDate, 'deliveryDateError', '请选择到货日期');
                isValid = false;
            }
            
            // 仓库验证
            const warehouse = document.getElementById('warehouse');
            if (!warehouse.value) {
                showError(warehouse, 'warehouseError', '请选择仓库');
                isValid = false;
            }
            
            // 物料明细验证
            const materialRows = document.querySelectorAll('.material-row');
            if (materialRows.length === 0) {
                document.getElementById('materialsError').classList.remove('hidden');
                isValid = false;
            } else {
                materialRows.forEach(row => {
                    // 物料编码验证
                    const codeInput = row.querySelector('.material-code');
                    const codeError = row.querySelector('.material-code-error');
                    if (!codeInput.value.trim()) {
                        showMaterialRowError(codeInput, codeError, '物料编码不能为空');
                        isValid = false;
                    }
                    
                    // 物料名称验证
                    const nameInput = row.querySelector('.material-name');
                    const nameError = row.querySelector('.material-name-error');
                    if (!nameInput.value.trim()) {
                        showMaterialRowError(nameInput, nameError, '物料名称不能为空');
                        isValid = false;
                    }
                    
                    // 单位验证
                    const unitInput = row.querySelector('.material-unit');
                    const unitError = row.querySelector('.material-unit-error');
                    if (!unitInput.value.trim()) {
                        showMaterialRowError(unitInput, unitError, '单位不能为空');
                        isValid = false;
                    }
                    
                    // 订单数量验证
                    const orderQtyInput = row.querySelector('.material-order-qty');
                    const orderQtyError = row.querySelector('.material-order-qty-error');
                    if (!orderQtyInput.value || orderQtyInput.value <= 0) {
                        showMaterialRowError(orderQtyInput, orderQtyError, '请输入有效的订单数量');
                        isValid = false;
                    }
                    
                    // 到货数量验证
                    const deliveryQtyInput = row.querySelector('.material-delivery-qty');
                    const deliveryQtyError = row.querySelector('.material-delivery-qty-error');
                    if (!deliveryQtyInput.value || deliveryQtyInput.value < 0) {
                        showMaterialRowError(deliveryQtyInput, deliveryQtyError, '请输入有效的到货数量');
                        isValid = false;
                    } else if (parseFloat(deliveryQtyInput.value) > parseFloat(orderQtyInput.value)) {
                        showMaterialRowError(deliveryQtyInput, deliveryQtyError, '到货数量不能大于订单数量');
                        isValid = false;
                    }
                    
                    // 验收数量验证
                    const acceptQtyInput = row.querySelector('.material-accept-qty');
                    const acceptQtyError = row.querySelector('.material-accept-qty-error');
                    if (!acceptQtyInput.value || acceptQtyInput.value < 0) {
                        showMaterialRowError(acceptQtyInput, acceptQtyError, '请输入有效的验收数量');
                        isValid = false;
                    } else if (parseFloat(acceptQtyInput.value) > parseFloat(deliveryQtyInput.value)) {
                        showMaterialRowError(acceptQtyInput, acceptQtyError, '验收数量不能大于到货数量');
                        isValid = false;
                    }
                    
                    // 验收结果验证
                    const resultSelect = row.querySelector('.material-result');
                    const resultError = row.querySelector('.material-result-error');
                    if (!resultSelect.value) {
                        showMaterialRowError(resultSelect, resultError, '请选择验收结果');
                        isValid = false;
                    } else {
                        // 不合格原因验证（如果需要）
                        const reasonTextarea = row.querySelector('.material-reason');
                        if ((resultSelect.value === 'unqualified' || resultSelect.value === 'partial') && !reasonTextarea.value.trim()) {
                            reasonTextarea.classList.add('input-error');
                            isValid = false;
                        } else {
                            reasonTextarea.classList.remove('input-error');
                        }
                    }
                });
            }
            
            // 总体验收结果验证
            const overallResult = document.querySelector('input[name="overallResult"]:checked');
            if (!overallResult) {
                document.getElementById('overallResultError').textContent = '请选择总体验收结果';
                document.getElementById('overallResultError').classList.remove('hidden');
                isValid = false;
            }
            
            return isValid;
        }
        
        // 显示提示消息
        function showToast(message, type = 'success') {
            const bgColors = {
                success: 'bg-success text-white',
                error: 'bg-danger text-white',
                warning: 'bg-warning text-white',
                info: 'bg-secondary text-white'
            };
            
            toast.innerHTML = `<i class="fa fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i> ${message}`;
            toast.className = `fixed top-4 right-4 px-4 py-3 rounded-md shadow-lg transform transition-all duration-300 z-50 flex items-center gap-2 ${bgColors[type]}`;
            toast.classList.remove('translate-x-full', 'opacity-0');
            
            setTimeout(() => {
                toast.classList.add('translate-x-full', 'opacity-0');
            }, 3000);
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
